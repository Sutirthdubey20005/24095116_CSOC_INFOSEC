# üõ°Ô∏è CSOC InfoSec Forensics - Advent of Cyber 2023, Day 19: Memory Forensics with Volatility

This writeup provides a detailed walkthrough and solutions for **Advent of Cyber 2023, Day 19**, which focuses on practical memory forensics using the **Volatility Framework**. The primary objective is to analyze a provided Linux memory dump (`linux.mem`) to uncover various artifacts of malicious activity, including exposed credentials, identification of suspicious processes (like a cryptocurrency miner), extraction of their binaries, and discovery of their communication channels and persistence mechanisms.

## Key Concepts in Memory Forensics:

* **Volatility Framework:** An open-source memory forensics framework used for extracting digital artifacts from volatile memory (RAM) dumps.
* **Memory Dump (`.mem` file):** A snapshot of a computer's RAM at a specific point in time, crucial for analyzing live system state.
* **Profiles:** Volatility uses profiles specific to the operating system and kernel version of the memory dump to correctly interpret the data structures.
* **Plugins:** Volatility's functionality is extended through various plugins, each designed to extract specific types of information (e.g., process lists, network connections, command history).
* **Process ID (PID):** A unique identifier assigned to each running process by the operating system.
* **MD5 Hash:** A cryptographic hash function used to verify data integrity and uniquely identify files.
* **C2 Server (Command and Control):** A server used by attackers to send commands to compromised systems and receive data.
* **Defanging URLs:** Modifying URLs to prevent accidental clicks while still displaying them for analysis (e.g., changing `.` to `[.]`).

## WALKTHROUGH

Below are the questions from the task, along with the Volatility commands used to find the answers, detailed explanations of each step, and the corresponding results.

**Memory Image:** `linux.mem`
**Volatility Profile:** `LinuxUbuntu_5_4_0‚Äì163-generic_profilex64`

---

### Q#1: What is the exposed password that we find from the bash history output?

üéØ **Goal:** To identify any sensitive information, specifically a password, that might have been entered or exposed through the command-line interface and captured in the system's bash history within the memory dump.

* **Command:**

    ```bash
    vol.py -f linux.mem --profile="LinuxUbuntu_5_4_0‚Äì163-generic_profilex64" linux_bash
    ```

* **Explanation:**
    The `linux_bash` plugin is a powerful Volatility tool that extracts the command-line history for active user sessions from the memory image. Attackers or compromised users often type commands directly into the shell, and if credentials are included in these commands (e.g., `sshpass -p 'password' ssh user@host`), they can be found in plain text. Analyzing this output is crucial for understanding user activity and identifying credential exposure.

* **Answer:** `NEhX4VSrN7sV`

---

### Q#2: What is the PID of the miner process that we find?

üéØ **Goal:** To identify the unique Process ID (PID) of the suspicious cryptocurrency miner process that is actively running in the system's memory.

* **Command:**

    ```bash
    vol.py -f linux.mem --profile="LinuxUbuntu_5_4_0‚Äì163-generic_profilex64" linux_pslist
    ```

* **Explanation:**
    The `linux_pslist` plugin enumerates all processes that were running at the time the memory dump was taken. This provides a list of PIDs, process names, parent PIDs, and other valuable information. By reviewing this list, an analyst can spot unusual or unauthorized processes, such as a cryptocurrency miner, which typically consumes significant system resources. Identifying its PID is the first step for further investigation of that specific process.

* **Answer:** `10280`

---

### Q#3: What is the MD5 hash of the miner process?

üéØ **Goal:** To obtain the MD5 hash of the executable binary file associated with the identified miner process. This hash serves as a unique digital fingerprint for the malware.

* **Command:**

    ```bash
    mkdir extracted # Create a directory to store extracted binaries
    vol.py -f linux.mem --profile="LinuxUbuntu_5_4_0‚Äì163-generic_profilex64" linux_procdump -D extracted -p 10280
    # After dumping, navigate to the 'extracted' directory and calculate the hash:
    # md5sum extracted/miner.10280.0x400000
    ```

* **Explanation:**
    The `linux_procdump` plugin allows forensic analysts to extract the executable image of a running process directly from memory. By specifying the PID (`-p 10280`) and an output directory (`-D extracted`), Volatility will dump the process's binary to a file. Once the binary is extracted, its MD5 hash can be calculated using standard Linux utilities like `md5sum`. This hash is vital for threat intelligence, allowing analysts to search for known malware signatures in databases like VirusTotal or identify similar variants.

* **Answer:** `153a5c8efe4aa3be240e5dc645480dee`

---

### Q#4: What is the MD5 hash of the MySQL server process?

üéØ **Goal:** To obtain the MD5 hash of the `mysqlserver` process's executable binary, allowing for verification of its integrity or identification of potential tampering.

* **Command:**

    ```bash
    vol.py -f linux.mem --profile="LinuxUbuntu_5_4_0‚Äì163-generic_profilex64" linux_procdump -D extracted -p 10291
    # After dumping, calculate the hash:
    # md5sum extracted/mysqlserver.10291.0x400000
    ```

* **Explanation:**
    Similar to the miner process, the `linux_procdump` plugin is used here to extract the binary of the `mysqlserver` process (PID `10291`) from memory. Hashing legitimate system processes is a common forensic practice. If the hash differs from a known good hash for that specific MySQL version, it could indicate that the legitimate `mysqlserver` binary has been replaced or modified by an attacker (e.g., to act as a backdoor or to hide malicious functionality).

* **Answer:** `c586e774bb2aa17819d7faae18dad7d1`

---

### Q#5: Use the command `strings extracted/miner.<PID from question 2>.0x400000 | grep http://`. What is the suspicious URL? (Fully defang the URL using CyberChef)

üéØ **Goal:** To extract all printable strings from the dumped miner binary and then filter for potential HTTP/HTTPS URLs, which often reveal the malware's Command and Control (C2) server. The URL then needs to be "defanged" for safe sharing.

* **Command:**

    ```bash
    strings extracted/miner.10280.0x400000 | grep http://
    # Then manually defang the output using CyberChef or by replacing characters.
    ```

* **Explanation:**
    The `strings` command is invaluable for extracting human-readable text from binary files. Malware often embeds C2 server addresses, configuration details, or other interesting strings directly within its executable. By piping the output of `strings` to `grep http://`, we efficiently filter for potential web addresses. "Defanging" the URL (e.g., changing `http://` to `hxxp[://]` and `.` to `[.]`) is a security best practice to prevent accidental navigation to a malicious site when sharing forensic findings.

* **Answer:** `hxxp[://]mcgreedysecretc2[.]thm`

---

### Q#6: After reading the elfie file, what location is the mysqlserver process dropped in on the file system?

üéØ **Goal:** To determine the original file system path where the `mysqlserver` process binary was placed or "dropped" on the compromised system. This helps in understanding the attacker's persistence mechanisms.

* **Command:**

    ```bash
    vol.py -f linux.mem --profile="LinuxUbuntu_5_4_0‚Äì163-generic_profilex64" linux_find_file -i 0xffff9ce9b78280e8 -O elfie
    cat elfie
    ```

* **Explanation:**
    The `linux_find_file` plugin is used to locate and extract specific files from the memory image based on their inode or object address (`-i`). In this case, it's used to retrieve a file named `elfie` (likely a log or configuration file related to the `mysqlserver` process) from memory. Once extracted to the analyst's machine, the `cat elfie` command is used to display its contents. This file is expected to contain information about where the `mysqlserver` binary was originally installed or dropped on the file system, which is critical for understanding the malware's installation path and potential persistence.

* **Answer:** /var/tmp/.system-python3.8-Updates/mysqlserver

---

This walkthrough demonstrates advanced memory forensics techniques using Volatility to investigate a compromised Linux system, highlighting how to extract crucial artifacts for incident response, including exposed credentials, malware identification, C2 communication, and persistence mechanisms.
